
// var Site = function(){
    // 	this.symbol = "AAPL";
    // };
    
    var Site = function(){
        this.symbol = "MSFT";
    };
    
    Site.prototype.Init = function(){
        this.GetQuote();
        $("#symbol").on("click", function(){
            $(this).val("");
        });
    };
    
    
    $(function() {
        $("#symbol").autocomplete({
            source : function(request, response) {
                $.ajax({
                    type: "POST",
                    url : "/search",
                    dataType : "json",
                    cache: false,
                    data : {
                        q : request.term
                    },
                    success : function(data) {
                        var aData=$.map(data, function(item){
                            return{
                                label: item.Name + " (" + item.Symbol + ")",
                                value: item.Symbol
                            }
                        });
                        response(aData);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(textStatus + " " + errorThrown);
                    }
                });
            },
                    minLength : 2,
                    select: function(event, ui){
                        let stockvalue = ui.item.value;
                        console.log('ticker', stockvalue)
                        loadChart(stockvalue)
                        window.location.href = "/quote?symbol=" + stockvalue
                        //site.SubmitForm(stockvalue)
                        // $.ajax({
                        //     url: "/quote?symbol=" + stockvalue,
                        //     method: "GET",
                        //     cache: false
                        // }).done(function(data) {
                        //     var context = {};
                        //     var that = stockvalue;
                        //     context.shortName = data.shortName;
                        //     context.symbol = data.symbol;
                        //     context.price = data.ask;
                        //     console.log('context', context)
    
                        //     // call the request to load the chart and pass the data context with it.
                        //     that.LoadChart(context);
        
                        }
                    
            })
        });
    
    function loadChart(ticker) {
    
    Highcharts.getJSON(ticker, function (data) {
            // Create the chart
            Highcharts.stockChart('chart_container', {
                rangeSelector: {
                    selected: 1
                },
        
                title: {
                    text: 'AAPL Stock Price'
                },
        
                series: [{
                    name: 'AAPL',
                    data: data,
                    tooltip: {
                        valueDecimals: 2
                    }
                }]
            });
        });
    }
        
    // // const queryData = async (event, ui) => {
    // // 	console.log('event', event)
    // // 	console.log('ui', ui)
    // // 	console.log(ui.item.value);
    // // 	let response = await fetch("/getdata?q=" + ui.item.value);
    // // 	console.log("response", response)
    // // 	let stockdata = await response.text();
    // // 	document.querySelector('ul').innerHTML = stockdata;
    // // }
    
    
    // // Site.prototype.Init = function(){
    // // 	//this.GetQuote();
    // // 	$("#symbol").on("click", function(){
    // // 		$(this).val("");
    // // 	});
    // // };
    
    // // Site.prototype.GetQuote = function(){
    // // 	// store the site context.
    // // 	var that = stockvalue;
    
    // // 	// pull the HTTP REquest
    // // 	$.ajax({
    // // 		url: "/quote?symbol=" + that.symbol,
    // // 		method: "GET",
    // // 		cache: false
    // // 	}).done(function(data) {
    
    // // 		// set up a data context for just what we need.
    // // 		var context = {};
    // // 		context.shortName = data.shortName;
    // // 		context.symbol = data.symbol;
    // // 		context.price = data.ask;
    
    // // 		if(data.quoteType="MUTUALFUND"){
    // // 			context.price = data.previousClose
    // // 		}
    // //         console.log('context', context)
    
    // // 		// call the request to load the chart and pass the data context with it.
    // // 		that.LoadChart(context);
    // // 	});
    // // };
    
    // // Site.prototype.SubmitForm = function(ticker){
    // // 	this.symbol = ticker
    // // 	this.GetQuote();
    // // }
    
    // Site.prototype.LoadChart = function(quote){
    
    // 	var that = this;
    // 	$.ajax({
    // 		url: "/history?symbol=" + that.symbol,
    // 		method: "GET",
    // 		cache: false
    // 	}).done(function(data) {
    // 		that.RenderChart(JSON.parse(data), quote);
    // 	});
    // };
    
    // Site.prototype.RenderChart = function(data, quote){
    // 	var priceData = [];
    // 	var dates = [];
    
    // 	var title = quote.shortName  + " (" + quote.symbol + ") - " + numeral(quote.price).format('$0,0.00');
    
    // 	for(var i in data.Close){
    // 		var dt = i.slice(0,i.length-3);
    // 		var dateString = moment.unix(dt).format("MM/YY");
    // 		var close = data.Close[i];
    // 		if(close != null){
    // 			priceData.push(data.Close[i]);
    // 			dates.push(dateString);
    // 		}
    // 	}
    
    // 	Highcharts.chart('chart_container', {
    // 		title: {
    // 			text: title
    // 		},
    // 		yAxis: {
    // 			title: {
    // 				text: ''
    // 			}
    // 		},
    // 		xAxis: {
    // 			categories :dates,
    // 		},
    // 		legend: {
    // 			layout: 'vertical',
    // 			align: 'right',
    // 			verticalAlign: 'middle'
    // 		},
    // 		plotOptions: {
    // 			series: {
    // 				label: {
    // 					connectorAllowed: false
    // 				}
    // 			},
    // 			area: {
    // 			}
    // 		},
    // 		series: [{
    // 			type: 'area',
    // 			color: '#85bb65',
    // 			name: 'Price',
    // 			data: priceData
    // 		}],
    // 		responsive: {
    // 			rules: [{
    // 				condition: {
    // 					maxWidth: 640
    // 				},
    // 				chartOptions: {
    // 					legend: {
    // 						layout: 'horizontal',
    // 						align: 'center',
    // 						verticalAlign: 'bottom'
    // 					}
    // 				}
    // 			}]
    // 		}
    
    // 	});
    
    // };
    
    // var site = new Site();
    
    // $(document).ready(()=>{
    // 	site.Init();
    // })